<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: readable/static-zip.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: readable/static-zip.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>"use strict";
var ReadableStream = require("./constructor")["default"];
var isPromise = require("../utils").isPromise;

/**
 * Returns a new stream that will send data when all sources have emmited value.
 *
 * @param {Rest&lt;Promise|Stream>} ...sources Streams or promises to watch for
 * @param {Function} mapper The function to transform the results in a single
 *  value.
 * @returns {ReadableStream} The stream with the result values
 */
exports["default"] = function zip(/* ...sources, mapper*/) {
  var sources = [].slice.call(sources);
  var mapper = sources.pop();
  var queues = [];
  var isCompleted = [];

  return new ReadableStream(function(onNext, onError, onComplete) {

    function cancel() {
      subscriptions
        .filter(Boolean)
        .forEach(function(a) { a.cancel() });
    }

    var subscriptions = sources.map(function(source, index) {
      queues[index] = [];
      isCompleted[index] = false;

      function onNextSingle(value) {
        queues[index].push(value);
        if (queues.every(function(q) { return q.length > 0 })) {
          var values = queues.map(function(q) { return q.shift() });
          onNext(mapper.apply(null, values));
        }
      }
      function onErrorSingle(reason) {
        cancel();
        onError(reason);
      }
      function onCompleteSingle() {
        isCompleted[index] = true;
        if (isCompleted.every(Boolean)) {
          cancel();
          onComplete();
        }
      }

      if (source instanceof ReadableStream)
        return source.subscribe(onNextSingle, onErrorSingle, onCompleteSingle);

      if (isPromise(source)) {
        source.then(function(value) {
          onNextSingle(value);
          onCompleteSingle();
        }, onErrorSingle);
        return;
      }

      if (Array.isArray(source)) {
        setTimeout(function() {
          source.forEach(onNextSingle);
          onCompleteSingle();
        });
      }

      // TODO throw error unknown source type
    });

    return cancel;
  });
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ReadableStream.html">ReadableStream</a></li><li><a href="Subscription.html">Subscription</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Sep 30 2014 11:50:20 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
